class AdvancedClickableList{constructor(e){this.component=e,this.component.getInstance=()=>this,this.state=!1,this.itemsContainer=this.component.querySelector(".items-container"),this.eventsMap={blur:[],focus:[],clickItem:[]},this.selectedItem=null,this.initEvents()}initEvents(){this.initItems(this.itemsContainer.querySelectorAll(".list-item")),document.addEventListener("keydown",e=>{this.isFocused()&&("ArrowDown"==e.code?this.makeNextOptionActive():"ArrowUp"==e.code&&this.makePrevOptionActive(),"Escape"==e.code&&this.blur(),"Enter"==e.code)&&this.makeClickOnItem(this.itemsContainer.querySelector(".active"))})}initItems(e){for(var t of e)this.initItem(t);return e}initItem(e){return e.addEventListener("click",e=>{e.preventDefault(),this.makeClickOnItem(e.currentTarget)}),e}makeClickOnItem(e){e&&(this.selectedItem=e,this.callEvent("clickItem"),this.blur())}renderItem(e){var t=e.css_class||"";let r="";if(e.attrs)for(var[s,i]of Object.entries(e.attrs))r+=`${s}='${i}' `;var a=document.createElement("DIV");return a.innerHTML=`<li class="list-item ${t}" ${r}>${e.text}</li>`,a.children[0]}appendItem(e){e=this.renderItem(e),this.initItem(e),this.itemsContainer.appendChild(e)}appendItems(e){for(var t of e)this.appendItem(t)}clearItemsContainer(){this.itemsContainer.innerHTML=""}isFocused(){return"focused"==this.state}focus(){this.state="focused",this.callEvent("focus")}blur(){this.state="blurred",this.selectedItem=null,this.callEvent("blur")}makeNextOptionActive(){var e=this.itemsContainer.querySelector(".active");e?(e.classList.remove("active"),(e=e.nextElementSibling)||this.makeNextOptionActive(),e?.classList?.add("active")):this.itemsContainer?.children[0]?.classList.add("active"),this.scrollToSelectedOption()}makePrevOptionActive(){var e=this.itemsContainer.querySelector(".active");e?(e.classList.remove("active"),(e=e.previousElementSibling)||this.makePrevOptionActive(),e?.classList?.add("active")):this.itemsContainer?.children[this.itemsContainer?.children.length-1]?.classList.add("active"),this.scrollToSelectedOption()}scrollToSelectedOption(){this.itemsContainer.scrollHeight;var e=this.itemsContainer.querySelector(".active").offsetTop-this.itemsContainer.querySelector(".active").clientHeight;this.itemsContainer.scrollTop=e}addEventListener(e,t){this.eventsMap[e].push(t)}addEventOnBlur(e){this.addEventListener("blur",e)}addEventOnFocus(e){this.addEventListener("focus",e)}addEventOnClickItem(e){this.addEventListener("clickItem",e)}callEvent(e){for(var t of this.eventsMap[e])t(this)}getSelectedItem(){return this.selectedItem}getItems(){return this.itemsContainer.children}}class Alert{constructor(e,t,r,s){this.id="alert-id-"+(new Date).getTime()+Math.random(),(alertsList[this.id]=this).type=e,this.content=t||"",this.isSingleton=r||!1,this.isClosable=s||!1;e=document.querySelector('.component.alert[data-id="alert-id-reference"]');if(!e)return console.error("Reference of alert component not found");this.template=e.cloneNode(!0),this.template.getInstance=()=>this,this.initComponent()}initComponent(){this.template.classList.add("alert-"+this.type),this.template.setAttribute("data-id",this.id),this.template.querySelector(".content").innerHTML=this.content,this.template.querySelector(".close-alert").addEventListener("click",e=>{e.preventDefault(),this.close()})}showIn(e){return!!this.template&&(this.isSingleton&&(e.innerHTML=""),e.append(this.template),setTimeout(()=>{this.template.classList.add("show")},10),this)}close(){this.template.classList.remove("show"),setTimeout(()=>{this.template.remove(),delete alertsList[this.id]},150)}changeContent(e){this.template.querySelector(".content").innerHTML=e}}const closeAlertComponent=e=>alertsList[e]?.close(),createAlertComponent=(e,t,r,s)=>new Alert(e,t,r,s),alertsList=(document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll(".component.alert .close-alert").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();e=e.currentTarget.getAttribute("data-close-alert-id");closeAlertComponent(e)})})}),{});class App{constructor(){console.log("App Start"),this.search=new Search(document.querySelector(".component.search-bar")),this.favorite=new Favorite(document.querySelectorAll("[data-make-favorite]")),this.orderForm=new OrderForm(document.querySelector("form.form.order")),this.orders=new Orders,this.initBaseEvents(),this.initControlPanelEvents(),this.initPreloaders(),document.querySelectorAll("a, button").forEach(e=>{e.getAttribute("tabindex")||e.setAttribute("tabindex",-1)})}initBaseEvents(){document.querySelector(".btn-nav-on-mob-show").addEventListener("click",e=>{e.currentTarget.classList.contains("active")?(e.currentTarget.classList.remove("active"),document.querySelectorAll(".navigation-main-wrapper, .userbar-wrapper").forEach(e=>{e.classList.remove("show")})):(e.currentTarget.classList.add("active"),document.querySelectorAll(".navigation-main-wrapper, .userbar-wrapper").forEach(e=>{e.classList.add("show")}))}),autosize(document.querySelectorAll("textarea")),document.querySelectorAll(".input-counter[data-counter-for-input]").forEach(r=>{document.querySelector("#"+r.getAttribute("data-counter-for-input")).addEventListener("input",e=>{var t=e.currentTarget.value.length,e=parseInt(e.currentTarget.getAttribute("maxlength"));0<t&&!r.classList.contains("show")&&r.classList.add("show"),0==t&&r.classList.contains("show")&&r.classList.remove("show"),r.innerHTML=e-t})}),document.querySelectorAll("[data-show-phone-number]").forEach(e=>{e.addEventListener("click",e=>{void 0===e.currentTarget.dataset.viewFlag&&e.preventDefault();var t=e.currentTarget.getAttribute("data-show-phone-number");e.currentTarget.innerHTML=t,e.currentTarget.href="tel:"+t})}),document.querySelectorAll("[data-show-phone-number][data-uadpost-id]").forEach(e=>{e.addEventListener("click",e=>{if(void 0!==e.currentTarget.dataset.viewFlag)return!1;var t=e.currentTarget.dataset.uadpostId;e.currentTarget.dataset.viewFlag=!0,fetch(ROUTES["UAdPostController@view_phone_number"].replace("$uap_id",t))})}),document.addEventListener("click",e=>{document.querySelectorAll(".component.local-menu.active").forEach(e=>e.classList.remove("active"))}),document.querySelectorAll(".component.local-menu .local-menu-active-btn").forEach(e=>e.addEventListener("click",e=>{const t=e.currentTarget.parentNode;setTimeout(()=>{t.classList.add("active")},0)})),lib.collapse().init(),document.querySelectorAll(".component.price-container").forEach(e=>{"1"==e.dataset.altPriceFlag&&e.addEventListener("click",e=>{e.currentTarget.classList.contains("alt-price")?e.currentTarget.classList.remove("alt-price"):e.currentTarget.classList.add("alt-price")})})}initControlPanelEvents(){document.querySelectorAll("[data-uadpost-remove-action]").forEach(e=>e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-uadpost-remove-action");confirmPopup.show({heading:_atxt("accept_removing"),applyBtnText:_atxt("remove"),applyBtnType:"danger",cancelBtnText:_atxt("cancel"),applyCallback:()=>{document.location=t}})})),document.querySelectorAll("[data-uadpost-deactivate-action]").forEach(e=>e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-uadpost-deactivate-action");confirmPopup.show({heading:_atxt("deactivate_selected_uadpost"),applyBtnText:_atxt("deactivate"),applyBtnType:"warning",cancelBtnText:_atxt("cancel"),applyCallback:()=>{document.location=t}})})),document.querySelectorAll("[data-uadpost-activate-action]").forEach(e=>e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-uadpost-activate-action");confirmPopup.show({heading:_atxt("publishing_selected_uadpost"),applyBtnText:_atxt("publishing"),applyBtnType:"success",cancelBtnText:_atxt("cancel"),applyCallback:()=>{document.location=t}})}))}initPreloaders(){document.querySelectorAll(".component.preloader").forEach(e=>{void 0===e.getInstance&&new Preloader(e)})}}document.addEventListener("DOMContentLoaded",e=>{window.app=new App});class Auth{constructor(){this.alert,this.form=document.querySelector(".auth-form .form"),this.alertContainer=this.form.querySelector(".alert-container"),this.submitBtn=this.form.querySelector(".submit"),this.initEvents()}initEvents(){this.form.addEventListener("submit",e=>{if(e.preventDefault(),this.submitBtn.classList.contains("disable"))return!1;this.submitBtn.classList.add("disable"),"signup"==this.form.getAttribute("data-form-alias")?this.submitSignupForm():this.submitSigninForm()}),this.form.querySelectorAll("input[data-for-submiting]").forEach(e=>{e.addEventListener("input",e=>{e.currentTarget.classList.remove("error")})}),this.form.querySelectorAll("input[data-for-submiting]").forEach(e=>{e.addEventListener("change",e=>{this.alert&&this.alert.close()})})}submitSignupForm(){return this.form.querySelector("#terms_of_use").checked?this.submit():(this.alert=createAlertComponent("danger",_atxt("terms_of_use_not_selected"),!0,!0).showIn(this.alertContainer),this.submitBtn.classList.remove("disable"),!1)}submitSigninForm(){return this.submit()}submit(){var e,t=new FormData;for(e of this.form.querySelectorAll("input[data-for-submiting]"))e.classList.contains("error")&&e.classList.remove("error"),t.append(e.getAttribute("name"),e.value);this.alert&&this.alert.close();const r=new XMLHttpRequest;r.open("POST",this.form.getAttribute("action")),r.onload=()=>{if(this.submitBtn.classList.remove("disable"),200==r.status){const t=JSON.parse(r.response);if(!t.status){for(var e of t.failed_fields)this.form.querySelector(`[name="${e}"]`).classList.add("error");return this.alert=createAlertComponent("danger",t.msg,!0,!0).showIn(this.alertContainer),!1}this.submitBtn.classList.add("disable"),this.alert=createAlertComponent("success",_atxt("success_and_redirecting"),!0).showIn(this.alertContainer),setTimeout(()=>{document.location=t.data.redirect_url},t.data.redirect_delay)}else console.error("Undefined error on server"),this.alert=createAlertComponent("danger",_atxt("undefined_error"),!0,!0).showIn(this.alertContainer)},r.onerror=function(){console.error("Error of request to server"),this.alert=createAlertComponent("danger",_atxt("server_not_available"),!0,!0).showIn(this.alertContainer)},r.send(t)}}class Carousel{constructor(e){this.component=e,this.imgsContainer=this.component.querySelector(".imgs-container"),this.imgs=this.imgsContainer.querySelectorAll(".img-item"),this.prevBtns=this.component.querySelectorAll('[data-carousel-control="prev"]'),this.nextBtns=this.component.querySelectorAll('[data-carousel-control="next"]'),this.imgPreviewsContainer=this.component.querySelector(".img-previews"),this.previews=this.imgPreviewsContainer.querySelectorAll(".img-preview-item"),this.imgViewer=this.component.querySelector(".carousel-img-view"),this.imgViewerCloseBtn=this.imgViewer.querySelector(".btn-popup-close"),this.imgViewObject=this.imgViewer.querySelector(".view"),this.controlPanel=this.component.querySelector(".carousel-control"),this.imgViewerPreloader=this.imgViewer.querySelector(".preloader-wrap"),this.imgViewerPreloaderComponent=new Preloader(this.imgViewerPreloader.querySelector(".component.preloader")),this.renderFieldPreloader=this.component.querySelector(".render-field .preloader-wrap"),this.renderFieldPreloaderComponent=new Preloader(this.renderFieldPreloader.querySelector(".component.preloader")),this.component.getInstance=()=>this,this.viewerMode=!1,this.initEvents(),this.total=this.imgs.length,this.currentNum=0,this.update()}initEvents(){this.prevBtns.forEach(e=>e.addEventListener("click",e=>this.prevImg())),this.nextBtns.forEach(e=>e.addEventListener("click",e=>this.nextImg())),this.previews.forEach(e=>e.addEventListener("click",e=>this.goToImg(e.currentTarget.getAttribute("data-carousel-control-goto")))),this.imgs.forEach(e=>e.querySelector("img").addEventListener("click",e=>{this.view(e.currentTarget.getAttribute("data-carousel-control-view"))})),this.imgs.forEach(e=>e.querySelector("img").addEventListener("load",e=>{e.currentTarget.getAttribute("data-lazy-load")||this.renderFieldPreloaderComponent.hide()})),this.imgViewerCloseBtn.addEventListener("click",e=>this.closeView()),this.imgViewObject.addEventListener("load",e=>{e.currentTarget.classList.remove("hide"),this.imgViewerPreloaderComponent.hide()}),this.keyboardEvents()}keyboardEvents(){window.addEventListener("keyup",e=>{this.isFullScreenView()&&27==e.keyCode&&this.closeView(),37==e.keyCode?this.prevImg():39==e.keyCode&&this.nextImg()})}prevImg(){this.currentNum--,this.currentNum<0?this.currentNum=0:this.update()}nextImg(){this.currentNum++,this.currentNum>this.total-1?this.currentNum=this.total-1:this.update()}update(){this.imgsContainer.style.marginLeft=`-${this.currentNum}00%`,this.currentNum<=0?this.prevBtns.forEach(e=>e.classList.add("disable")):this.prevBtns.forEach(e=>e.classList.remove("disable")),this.currentNum>=this.total-1?this.nextBtns.forEach(e=>e.classList.add("disable")):this.nextBtns.forEach(e=>e.classList.remove("disable")),this.updatePreviews(),this.lazyLoad(this.imgs[this.currentNum].querySelector("img")),this.viewerMode&&(this.imgViewerPreloaderComponent.show(),this.imgViewObject.classList.add("hide"),this.imgViewObject.src=this.imgs[this.currentNum].querySelector("img").getAttribute("data-carousel-control-view"))}updatePreviews(){this.previews.forEach(e=>e.classList.remove("active")),this.previews[this.currentNum].classList.add("active");var e=this.previews[this.currentNum].offsetLeft;this.previews[this.currentNum].clientWidth,this.imgPreviewsContainer.clientWidth;this.imgPreviewsContainer.scrollTo({left:e-50,behavior:"smooth"})}lazyLoad(e){var t=e.getAttribute("data-lazy-load");t&&(this.renderFieldPreloaderComponent.show(),e.src=t,e.removeAttribute("data-lazy-load"))}goToImg(e){e!=this.currentNum&&0<=e&&e<=this.total-1&&(this.currentNum=e,this.update())}view(e){this.viewerMode=!0,this.imgViewerPreloaderComponent.show(),this.imgViewObject.src=e,this.imgViewObject.classList.add("hide"),this.imgViewer.classList.add("show"),setTimeout(()=>{this.controlPanel.classList.add("viewer-mode")},150)}closeView(){this.viewerMode=!1,this.imgViewerPreloaderComponent.hide(),this.imgViewer.classList.remove("show"),this.controlPanel.classList.remove("viewer-mode")}isFullScreenView(){return this.viewerMode}}class ConfirmPopup{constructor(e){this.component=e,this.component.getInstance=()=>this,this.heading=this.component.querySelector(".heading"),this.body=this.component.querySelector(".body"),this.btnApply=this.component.querySelector(".apply"),this.btnCancel=this.component.querySelector(".cancel"),this.btnClose=this.component.querySelector(".btn-popup-close"),this.backBlur=this.component.querySelector(".popup-back-blur"),this.resetCallbacks(),this.resetTexts(),this.resetBtnsTypes(),this.initEvents()}resetCallbacks(){this.applyCallback=()=>{},this.cancelCallback=()=>{},this.closeCallback=()=>{}}resetTexts(){this.setTexts("","",_atxt("accept"),_atxt("cancel"))}resetBtnsTypes(){this.btnApply.classList.remove("btn-warning","btn-success","btn-danger","btn-default"),this.btnCancel.classList.remove("btn-warning","btn-success","btn-danger","btn-primary"),this.btnApply.classList.add("btn-primary"),this.btnCancel.classList.add("btn-default")}setTexts(e,t,r,s){this.heading.innerHTML=e,this.body.innerHTML=t||"",this.btnApply.innerHTML=r,this.btnCancel.innerHTML=s}setBtnsTypes(e,t){e=e||"primary",t=t||"default",this.btnApply.classList.remove("btn-primary"),this.btnApply.classList.add("btn-"+e),this.btnCancel.classList.remove("btn-default"),this.btnCancel.classList.add("btn-"+t)}initEvents(){this.btnApply.addEventListener("click",e=>{this.applyCallback(),this.close()}),this.btnCancel.addEventListener("click",e=>{this.cancelCallback(),this.close()});var e=e=>{this.closeCallback(),this.close()};this.btnClose.addEventListener("click",e),this.backBlur.addEventListener("click",e)}show(e){this.applyCallback=e.applyCallback,e.cancelCallback&&(this.cancelCallback=e.cancelCallback),e.closeCallback&&(this.closeCallback=e.closeCallback),this.setTexts(e.heading,e.body,e.applyBtnText,e.cancelBtnText),this.setBtnsTypes(e.applyBtnType,e.cancelBtnType),this.component.classList.add("show")}close(){this.component.classList.remove("show"),this.resetCallbacks(),setTimeout(()=>{this.resetTexts(),this.resetBtnsTypes()},150)}}class Favorite{constructor(e){this.btns=e,this.btns.forEach(e=>e.getInstance=()=>this),this.initEvents()}initEvents(){this.btns.forEach(e=>e.addEventListener("click",e=>this.make(e.currentTarget)))}make(t){var e=t.getAttribute("data-uadpost-id");this.changeBtnVisualState(t);const r=new XMLHttpRequest;r.open("POST",ROUTES["FavouritesController@make"]),r.onload=()=>{var e;200==r.status?(e=JSON.parse(r.response)).status||(this.changeBtnVisualState(t),console.error("Error with msg: "+e.msg)):(this.changeBtnVisualState(t),console.error("Request error of changing favorite status"))};var s=new FormData;s.append("uadpost_id",e),r.send(s)}changeBtnVisualState(e){e.classList.contains("active")?e.classList.remove("active"):e.classList.add("active")}}class ImgUploader{constructor(e,t,r){this.component=e,this.initEvents(),this.counter=this.component.querySelectorAll("[data-alias]").length,this.maxNumberImgs=t,this.emptyTemplate=this.component.querySelector(".reference-selected-img .selected-img.empty").cloneNode(!0),this.uploadAction=r,this.component.parentNode.getInstance=()=>this}initEvents(){this.component.querySelector(".add-img").addEventListener("click",e=>{this.component.querySelector('input[name="imgs"]').click()}),this.component.querySelector('input[name="imgs"]').addEventListener("change",e=>{for(var t of e.currentTarget.files)this.setFile(t);e.currentTarget.value=""}),this.component.addEventListener("dragover",e=>{e.preventDefault();for(var t of e.dataTransfer.items)if("file"==t.kind&&"image/jpeg"==t.type){this.component.classList.add("drag-and-drop");break}}),this.component.addEventListener("dragleave",e=>{e.preventDefault(),this.component.classList.remove("drag-and-drop")}),this.component.addEventListener("drop",e=>{e.preventDefault(),this.component.classList.remove("drag-and-drop");for(var t of e.dataTransfer.items)"file"==t.kind&&this.setFile(t.getAsFile())}),this.component.querySelectorAll(".selected-img").forEach(e=>{e.classList.contains(".empty")||this.addEventsTo(e)})}addEventsTo(e){e.querySelector(".btn-remove").addEventListener("click",e=>{e.preventDefault(),e.currentTarget.parentNode.parentNode.remove(),this.component.querySelector(".add-img").classList.remove("dnone"),this.counter--,this.component.querySelector(".selected-imgs-grid").appendChild(this.emptyTemplate.cloneNode(!0))}),e.querySelector(".btn-move-left").addEventListener("click",e=>{e.preventDefault();var t=e.currentTarget.parentNode.parentNode.previousElementSibling.querySelector("img"),e=e.currentTarget.parentNode.parentNode.querySelector("img");e.parentNode.appendChild(t.cloneNode()),t.parentNode.appendChild(e.cloneNode()),t.remove(),e.remove()})}checkNumberImgsOnMax(){return this.counter>=this.maxNumberImgs&&(this.component.querySelector(".add-img").classList.add("dnone"),!0)}getPreparedData(){const t=[];return this.component.querySelectorAll(".selected-img img[data-alias]").forEach(e=>{t.push({alias:e.getAttribute("data-alias"),path:e.getAttribute("data-path"),url:e.getAttribute("data-url")})}),t}setFile(e){if("image/jpeg"!=e.type)return!1;let r=new FileReader;r.readAsDataURL(e),r.onload=()=>{var e,t;return!this.checkNumberImgsOnMax()&&((e=document.createElement("img")).src=r.result,(t=this.component.querySelector(".selected-imgs-grid .selected-img.empty")).classList.remove("empty"),t.appendChild(e),this.uploadImg(t,r.result),this.counter++,!this.checkNumberImgsOnMax())&&void 0},r.onerror=()=>{console.error("Error of upload img")}}uploadImg(t,e){var r=new FormData;r.append("img",e);const s=t.querySelector(".upload-progress-bar .bar"),i=t.querySelector("img"),a=(t.classList.add("load-process"),new XMLHttpRequest);a.open("POST",this.uploadAction),a.onload=()=>{var e;t.classList.remove("load-process"),200==a.status&&(e=JSON.parse(a.response)).status&&(i.setAttribute("data-alias",e.data.image.alias),i.setAttribute("data-path",e.data.image.path),i.setAttribute("data-url",e.data.image.url))},a.upload.onprogress=e=>{e=e.loaded/e.total*100;s.style.width=e+"%"},a.onerror=()=>{console.error("Upload error")},a.send(r)}}class Lib{constructor(){this.collapse=function(){return this.init=()=>{document.querySelectorAll("[data-collapse-toggle]").forEach(e=>e.addEventListener("click",e=>{lib.collapse().toggle(e.currentTarget.getAttribute("data-collapse-toggle"))})),document.querySelectorAll("[data-collapse-show]").forEach(e=>e.addEventListener("click",e=>{lib.collapse().show(e.currentTarget.getAttribute("data-collapse-show"))})),document.querySelectorAll("[data-collapse-hide]").forEach(e=>e.addEventListener("click",e=>{lib.collapse().hide(e.currentTarget.getAttribute("data-collapse-hide"))}))},this.show=e=>{const t=document.querySelector(e);t.classList.contains("collapsing")||t.classList.contains("collapse-show")||(t.classList.remove("collapse"),e=t.offsetHeight,t.style.height=0,t.style.overflow="hidden",t.style.transition="height 150ms linear",t.classList.add("collapsing"),t.offsetHeight,t.style.height=e+"px",window.setTimeout(()=>{t.classList.remove("collapsing"),t.classList.add("collapse"),t.classList.add("collapse-show"),t.style.height="",t.style.transition="",t.style.overflow=""},150))},this.hide=e=>{const t=document.querySelector(e);!t.classList.contains("collapsing")&&t.classList.contains("collapse-show")&&(t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.height=0,t.style.overflow="hidden",t.style.transition="height 150ms linear",t.classList.remove("collapse"),t.classList.remove("collapse-show"),t.classList.add("collapsing"),window.setTimeout(()=>{t.classList.remove("collapsing"),t.classList.add("collapse"),t.style.height="",t.style.transition="",t.style.overflow=""},150))},this.toggle=e=>{document.querySelector(e).classList.contains("collapse-show")?this.hide(e):this.show(e)},this},this.simpleAJAXRequest=(e,t,r)=>{const s=e=>setTimeout(()=>e.close(),4e3),i=new XMLHttpRequest;i.open("GET",e),i.onload=()=>{var e;200==i.status?(e=JSON.parse(i.response)).status?t(e,r):s(createAlertComponent("danger",e.msg,!0,!0).showIn(r)):(s(createAlertComponent("danger",_atxt("undefined_error"),!0,!0).showIn(r)),console.error("Request error. Undefined server error"))},i.onerror=()=>{s(createAlertComponent("danger",_atxt("server_not_available"),!0,!0).showIn(r)),console.error("Request error. Server not available")},i.send()}}triggerEvent(e,t){var r=document.createEvent("HTMLEvents");r.initEvent(t,!1,!0),e.dispatchEvent(r)}}window.lib=new Lib;class NovaPoshta{constructor(e){this.component=e,this.component.getInstance=()=>this,this.addrCityRefInp=this.component.querySelector('[name="np_city_ref"]'),this.addrCityName=this.component.querySelector('[name="np_city_name"]'),this.searchableDropdownComponent=new SearchableDropdown(this.component.querySelector("#searchable-np-addr")),this.novaPoshtaDepartmentNumberSelectorWrap=this.component.querySelector(".nova-poshta-department-number-selector-group"),this.novaPoshtaDepartmentNumber=this.component.querySelector("#np_department"),this.novaPoshtaDepartmentNumberComponent=new Select(this.novaPoshtaDepartmentNumber),this.novaPoshtaDepartmentNumberPreloaderComponent=new Preloader(this.component.querySelector(".nova-poshta-department-number-selector-preloader")),this.minValueLength=1,this.init()}init(){this.searchableDropdownComponent.showServiceMsg("Начните вводить название"),this.searchableDropdownComponent.setCustomFilter((e,t)=>{var r=e.getSearchString().toLowerCase();r.length<=this.minValueLength?e.showServiceMsg("Начните вводить название"):this.loadAndRenderCity(r)}),this.searchableDropdownComponent.addEventOnChange((e,t)=>{this.addrCityRefInp.value=t.attrs["data-cityRef"],this.addrCityName.value=t.attrs["data-cityName"],this.loadAndRenderDepartments(),this.searchableDropdownComponent.blur()})}renderList(e){var t,r=[];for(t of e)r.push({text:`<button tabindex="-1">${t.Present}</button>`,attrs:{"data-value":t.Present,"data-city-ref":t.DeliveryCity,"data-city-name":t.MainDescription}});this.searchableDropdownComponent.renderItems(r),this.searchableDropdownComponent.refreshData()}show(){this.component.classList.add("show")}hide(){this.component.classList.remove("show")}showErrServerNotAvailable(){this.searchableDropdownComponent.showServiceMsg("Сервер новой почты не доступен")}loadAndRenderCity(e){const t=new XMLHttpRequest;t.open("POST",ROUTES["NPDeliveryController@api_req"]),t.onload=()=>{if(this.searchableDropdownComponent.hidePreloader(),200==t.status){var e=JSON.parse(t.response);if(!e.status)return this.showErrServerNotAvailable(),!1;(e=e.data).data.length&&e.data[0].Addresses.length?this.renderList(e.data[0].Addresses):(this.renderList([]),this.searchableDropdownComponent.showServiceMsg("Ничего не найдено"))}else this.showErrServerNotAvailable(),console.error("Request error of creating new order")},t.onerror=()=>{this.showErrServerNotAvailable(),this.searchableDropdownComponent.hidePreloader(),console.error("Request error of creating new order")};e=JSON.stringify({modelName:"Address",calledMethod:"searchSettlements",methodProperties:{CityName:e,Limit:"10",Page:"1"}});this.searchableDropdownComponent.showPreloader(),t.send(new URLSearchParams({req:e}))}loadAndRenderDepartments(e){const s=new XMLHttpRequest;s.open("POST",ROUTES["NPDeliveryController@api_req"]),s.onload=()=>{if(200==s.status){var e=JSON.parse(s.response);if(!e.status)return!1;if((e=e.data).data.length){var t,r=[];for(t in e.data)r.push({text:e.data[t].Description,value:JSON.stringify({SiteKey:e.data[t].SiteKey,Number:e.data[t].Number,Description:e.data[t].Description,DescriptionRu:e.data[t].DescriptionRu,Latitude:e.data[t].Latitude,Longitude:e.data[t].Longitude,Schedule:e.data[t].Schedule,PlaceMaxWeightAllowed:e.data[t].PlaceMaxWeightAllowed})});this.novaPoshtaDepartmentNumberComponent.renderOptions(r)}else this.novaPoshtaDepartmentNumberComponent.renderOptions([]);this.showNovaPoshtaDepartmentNumberComponent()}else console.error("Request error of creating new order")},s.onerror=()=>{console.error("Request error of creating new order")};var t=JSON.stringify({modelName:"Address",calledMethod:"getWarehouses",methodProperties:{CityName:this.addrCityName.value,CityRef:this.addrCityRefInp.value,Page:"1",Limit:"1000"}});this.novaPoshtaDepartmentNumberPreloaderComponent.show(),this.hideNovaPoshtaDepartmentNumberComponent(),s.send(new URLSearchParams({req:t}))}showNovaPoshtaDepartmentNumberComponent(){this.novaPoshtaDepartmentNumberSelectorWrap.style.display="block",this.novaPoshtaDepartmentNumberPreloaderComponent.hide(),this.novaPoshtaDepartmentNumberSelectorWrap.classList.add("show")}hideNovaPoshtaDepartmentNumberComponent(){this.resetNovaPoshtaDepartmentNumberValue(),this.novaPoshtaDepartmentNumberSelectorWrap.style.display="block",this.novaPoshtaDepartmentNumberSelectorWrap.classList.remove("show")}resetNovaPoshtaDepartmentNumberValue(){this.novaPoshtaDepartmentNumberComponent.reset()}}class OrderForm{constructor(e){this.component=e,this.alert,this.alertContainer=this.component?.querySelector(".alert-container"),this.submitBtn=this.component?.querySelector("button.submit"),this.cancelBtn=this.component?.querySelector("button.cancel"),this.novaPoshtaGroup=this.component?.querySelector(".nova-poshta-group"),this.deliveryMethodSelector=this.component?.querySelector("#delivery_method"),this.component&&(this.novaPoshtaComponent=new NovaPoshta(this.component.querySelector(".component.nova-poshta-addr-selector")),this.deliveryMethodSelectorComponent=new Select(this.deliveryMethodSelector)),this.component&&(this.component.getInstance=()=>this),this.initEvents(),this.initOrdersControl()}initEvents(){document.querySelectorAll(".btn-buy[data-uadpost-alias]").forEach(e=>{e.addEventListener("click",e=>{e=e.currentTarget.getAttribute("data-uadpost-alias");document.location=ROUTES["OrderController@new_order_page"].replace("$uadpost_alias",e)})}),this.component?.addEventListener("submit",e=>{e.preventDefault(),this.submitBtn.classList.contains("disable")||this.createNewOrder()}),this.cancelBtn?.addEventListener("click",e=>{e.preventDefault(),document.location=e.currentTarget.getAttribute("data-cancel-url")}),this.deliveryMethodSelectorComponent?.addEventOnChange((e,t)=>{"1"==t?this.novaPoshtaComponent?.show():this.novaPoshtaComponent?.hide()})}createNewOrder(){var e=this.getOrderData(),t=this.validateOrderData(e);return t.length?this.displayErrsOfData(t):this.submitNewOrder(e)}getOrderData(){return new FormData(this.component)}validateOrderData(e){return[]}submitNewOrder(e){this.disableFormControlBtns();const t=new XMLHttpRequest;t.open(this.component.getAttribute("method"),this.component.getAttribute("action")),t.onload=()=>{var e;this.enableFormControlBtns(),200==t.status?(e=JSON.parse(t.response)).status?document.location=ROUTES["OrderController@order_success_page"].replace("$order_id",e.data.details.order_id):(this.alert=createAlertComponent("danger",e.msg,!0,!0).showIn(this.alertContainer),this.lightningOfMistake(e.failed_fields)):(this.alert=createAlertComponent("danger","Request error of creating new order",!0,!0).showIn(this.alertContainer),console.error("Request error of creating new order"))},t.onerror=()=>{console.error("Request error of creating new order")},t.send(e)}disableFormControlBtns(){this.submitBtn.classList.add("disable"),this.cancelBtn.classList.add("disable")}enableFormControlBtns(){this.submitBtn.classList.remove("disable"),this.cancelBtn.classList.remove("disable")}initOrdersControl(){document.querySelectorAll("[data-order-action]").forEach(e=>e.addEventListener("click",e=>{const r=e.currentTarget,t=r.getAttribute("data-order-action");var e=r.getAttribute("data-order-btn-type"),s={confirm:_atxt("confirm"),cancel:_atxt("cancel_order"),complete:_atxt("complete_order")},i={confirm:_atxt("confirm"),cancel:_atxt("confirm"),complete:_atxt("confirm")},a={confirm:_atxt("cancel"),cancel:_atxt("cancel"),complete:_atxt("cancel")};confirmPopup.show({heading:s[e],applyBtnText:i[e],applyBtnType:{confirm:"success",cancel:"danger",complete:"success"}[e],cancelBtnText:a[e],applyCallback:()=>{lib.simpleAJAXRequest(t,(e,t)=>{this.alert=createAlertComponent("success",e.data.msg,!0,!0).showIn(t),setTimeout(()=>this.alert.close(),4e3);t=document.querySelector(`.order-card[data-order-id="${e.data.order_id}"]`);t.querySelector(".order-state").innerHTML=e.data.order_state_label,e.status&&(r.parentNode.remove(),(e=t.querySelector(".component.local-menu")).querySelectorAll("li").length||e.classList.add("dnone"))},document.querySelector(".user-area-page .alert-container"))}})}))}lightningOfMistake(e){if(e.length)for(var t of e)this.component.querySelector(`[name="${t}"]`)?.classList.add("error"),this.component.querySelector(".std-input."+t)?.classList.add("error")}}class Orders{constructor(){this.initEvents()}initEvents(){document.querySelectorAll("[data-show-delivery-details]").forEach(e=>{e.addEventListener("click",e=>{var t=document.querySelector(`.order-delivery-details[data-order-id="${e.currentTarget.dataset.showDeliveryDetails}"]`);"block"==t.style.display?(e.currentTarget.classList.remove("opened"),utils.slideUp(t)):(e.currentTarget.classList.add("opened"),utils.slideDown(t))})}),document.querySelectorAll(".orders-filters .filter-toggle").forEach(e=>{e.addEventListener("click",e=>{var t,r=e.currentTarget.dataset.filterState,r=(e.currentTarget.dataset.filterStateName,"enable"==r?(e.currentTarget.dataset.filterState="disable",e.currentTarget.classList.add("outline")):(e.currentTarget.dataset.filterState="enable",e.currentTarget.classList.remove("outline")),document.querySelectorAll(".orders-filters .filter-toggle")),s=[];for(t of r)"disable"==t.dataset.filterState&&s.push(t.dataset.filterStateName);e=new URLSearchParams(document.location.search);e.has("excluding")&&e.delete("excluding"),s.length&&e.append("excluding",s.join(",")),document.location.search=e.toString()})})}}class Paginator{constructor(e){this.component=e,this.id=this.component.id,this.inp=this.component.querySelector(".page-num-selector"),this.inp.addEventListener("keyup",e=>{let t=Math.floor(e.currentTarget.value);var r=parseInt(e.currentTarget.getAttribute("min")),s=parseInt(e.currentTarget.getAttribute("max"));13==e.keyCode&&((t=t<r?r:t)>s&&(t=s),e.currentTarget.value=t,r=e.currentTarget.getAttribute("data-current-url"),document.location=-1==r.indexOf("?")?r+("?pn="+t):r+("&pn="+t))}),this.inp.addEventListener("change",e=>{let t=Math.floor(e.currentTarget.value);var r=parseInt(e.currentTarget.getAttribute("min")),s=parseInt(e.currentTarget.getAttribute("max"));(t=t<r?r:t)>s&&(t=s),e.currentTarget.value=t})}}class Preloader{constructor(e){this.component=e,this.component.getInstance=()=>this}show(){this.component.style.display="inline-block",this.component.classList.add("show")}hide(){this.component.classList.remove("show");var e=parseFloat(getComputedStyle(this.component).transitionDuration);setTimeout(()=>{this.component.style.display="none"},1e3*e)}isVisible(){return this.component.classList.contains("show")}}class Search{constructor(e){this.component=e,this.searchFieldContainer=this.component.querySelector(".search-field-container"),this.searchInput=this.component.querySelector(".search-field"),this.btnSubmit=this.component.querySelector(".submit"),this.filtersContainer=document.querySelector(".component.search-filters"),this.filtersContainer&&(this.filtersForm=this.filtersContainer.querySelector("form.form"),this.filtersPriceRange=this.filtersContainer.querySelector(".price-range"),this.filtersPriceFrom=this.filtersPriceRange.querySelector("#price_from"),this.filtersPriceTo=this.filtersPriceRange.querySelector("#price_to"),this.filtersApplyBtn=this.filtersContainer.querySelector(".apply-filters"),this.filtersClearBtn=this.filtersContainer.querySelector(".clear-filters"),this.timeoutOfAutoClearSearchFilters=18e5),this.sortingForm=document.querySelector(".component.sorting"),this.sortingComponent,this.initEvents(),this.filtersContainer&&(this.autoClearSearchFilters(),this.restoreSearch(),this.initFilters()),this.sortingForm&&this.initSortingForm()}initEvents(){this.searchInput.addEventListener("keyup",e=>{13==e.keyCode&&this.startSearch(e.currentTarget.value,new FormData(this.filtersForm))}),this.btnSubmit.addEventListener("click",e=>{this.startSearch(this.searchInput.value,new FormData(this.filtersForm))}),this.searchInput.addEventListener("focus",e=>{this.searchFieldContainer.classList.add("infocus")}),this.searchInput.addEventListener("blur",e=>{this.searchFieldContainer.classList.remove("infocus")}),document.addEventListener("keydown",e=>{!e.ctrlKey||"/"!==e.key&&"."!==e.key||this.searchInput.focus()})}initFilters(){[this.filtersPriceFrom,this.filtersPriceTo].forEach(e=>{e.addEventListener("input",e=>{var t=this.filtersPriceFrom.value,r=this.filtersPriceTo.value;r<=t&&("price_from"==(e=e.currentTarget.getAttribute("name"))?this.filtersPriceTo.value=Math.round(parseFloat(t)+1):"price_to"==e&&(this.filtersPriceFrom.value=Math.round(parseFloat(r)-1)))})}),this.filtersForm.addEventListener("submit",e=>{e.preventDefault();e=new FormData(e.currentTarget);this.startSearch(this.searchInput.value,e)}),this.filtersClearBtn.addEventListener("click",e=>{e.preventDefault(),this.clearSearchFilters(),this.startSearch(e.currentTarget.value,new FormData(this.filtersForm))})}initSortingForm(){this.sortingComponent=new Sorting(this.sortingForm,this)}applySearchParamsAndSearching(){this.startSearch(this.searchInput.value,new FormData(this.filtersForm))}startSearch(e,t){const r={};t.forEach((e,t)=>{r[t]=e}),localStorage.setItem("search_query",e),localStorage.setItem("search_filters",JSON.stringify(r)),localStorage.setItem("search_filters_update_at",(new Date).getTime());t={s:e,...r,sorting:this.sortingComponent?this.sortingComponent.getValue():null},e=new URLSearchParams(t);document.location="/?"+e}autoClearSearchFilters(){var e=localStorage.getItem("search_filters_update_at");return!!e&&((new Date).getTime()-e>this.timeoutOfAutoClearSearchFilters?(this.clearSearchFilters(),!0):void 0)}clearSearchFilters(){localStorage.removeItem("search_query"),localStorage.removeItem("search_filters"),localStorage.removeItem("search_filters_update_at"),this.filtersForm.reset(),this.filtersForm.querySelector(".radius-slider .slider").getInstance().reset()}restoreSearch(){let r=localStorage.getItem("search_filters");if(!r)return!1;(r=JSON.parse(r)).exchange_flag||(r.exchange_flag="off");for(let t in r){var e;"condition"==t?this.filtersForm.querySelectorAll(`[name="${t}"]`).forEach(e=>{e.value==r[t]?e.setAttribute("checked","checked"):e.removeAttribute("checked")}):"exchange_flag"==t?(e=this.filtersForm.querySelector(`[name="${t}"]`),"on"==r[t]?e.setAttribute("checked","checked"):e.removeAttribute("checked")):((e=this.filtersForm.querySelector(`[name="${t}"]`)).value=r[t],window.lib.triggerEvent(e,"change"))}}}class SearchableDropdown{constructor(e){this.component=e,this.advancedClickableListComponent=new AdvancedClickableList(this.component.querySelector(".component.advanced-clickable-list")),this.searchField=this.component.querySelector("input.search"),this.selector=this.component.querySelector(".selector"),this.serviceMsg=this.component.querySelector(".service-msg"),this.preloaderComponent=new Preloader(this.component.querySelector(".searchable-dropdown-preloader")),this.data=[],this.itemId=null,this.onChangeHandlers=[],this.filterFunc=(e,t)=>{var r,s=e.getSearchString().toLowerCase(),i=[];for(r of e.data)r.text.toLowerCase().includes(s)&&i.push(r);e.renderItems(i)},this.initData(),this.renderItems(this.data),this.init()}initData(){var e;this.data=[];let t=0;for(e of this.advancedClickableListComponent.getItems()){var r,s={attrs:{"data-id":t++},text:e.innerHTML};for(r in e.dataset)s.attrs["data-"+r]=e.dataset[r];this.data.push(s)}}init(){this.searchField.addEventListener("focus",e=>{this.advancedClickableListComponent.focus(),this.searchField.classList.remove("error")}),this.searchField.addEventListener("blur",e=>{this.stateActive()&&this.advancedClickableListComponent.blur()}),this.advancedClickableListComponent.addEventOnClickItem(e=>{this.selectItem(e.getSelectedItem())}),this.advancedClickableListComponent.addEventOnBlur(e=>{this.blur()}),this.advancedClickableListComponent.addEventOnFocus(e=>{this.selector.classList.add("show")}),this.searchField.addEventListener("input",e=>{this.filtering()})}renderItems(e){this.advancedClickableListComponent.clearItemsContainer(),this.advancedClickableListComponent.appendItems(e),e.length?(this.advancedClickableListComponent.component.classList.remove("dnone"),this.hideServiceMsg()):(this.advancedClickableListComponent.component.classList.add("dnone"),this.showNoResultsMsg())}selectItem(e){this.itemId=parseInt(e.dataset.id),this.runChangeHandlers(this.getValue()),this.searchField.value=e.textContent}getValue(){for(var e of this.data)if(e.attrs["data-id"]==this.itemId)return e;return null}getSearchString(){return this.searchField.value}blur(){this.selector.classList.remove("show"),this.searchField.blur()}stateActive(){return this.advancedClickableListComponent.isFocused()}addEventOnChange(e){if("function"!=typeof e)return console.error("SearchableDropdown.addEventOnChange():","Event handler must be a function");this.onChangeHandlers.push(e)}runChangeHandlers(e){for(var t of this.onChangeHandlers)t(this,e)}filtering(){return this.filterFunc(this,this.advancedClickableListComponent)}refreshData(){this.initData(),this.renderItems(this.data)}setCustomFilter(e){if("function"!=typeof e)return console.error("SearchableDropdown.setCustomFilter()","Filter must be a function");this.filterFunc=e}showPreloader(){this.preloaderComponent.show()}hidePreloader(){this.preloaderComponent.hide()}showNoResultsMsg(){this.showServiceMsg("Нет подходящих вариантов")}showServiceMsg(e){this.serviceMsg.innerHTML=e,this.serviceMsg.classList.remove("dnone")}hideServiceMsg(){this.serviceMsg.innerHTML="",this.serviceMsg.classList.add("dnone")}}class Select{constructor(e){this.component=e,this.component.getInstance=()=>this,this.viewContainer=this.component.querySelector(".current-selected"),this.resultValueInput=this.component.querySelector("[data-name='result-value']"),this.displayingCurrentSelected=this.component.querySelector(".displaying-current-selected"),this.advancedClickableListComponent=new AdvancedClickableList(this.component.querySelector(".component.advanced-clickable-list")),this.onChangeHandlers=[],this.initEvents()}initEvents(){this.displayingCurrentSelected.addEventListener("focus",e=>{this.advancedClickableListComponent.focus(),this.displayingCurrentSelected.classList.remove("error")}),this.displayingCurrentSelected.addEventListener("blur",e=>{this.stateActive()&&this.advancedClickableListComponent.blur()}),this.advancedClickableListComponent.addEventOnClickItem(e=>{this.selectOption(e.getSelectedItem())}),this.advancedClickableListComponent.addEventOnBlur(e=>{this.blurComponent()}),this.advancedClickableListComponent.addEventOnFocus(e=>{this.component.classList.add("show")})}addEventOnChange(e){if("function"!=typeof e)return console.error("Select.addEventOnChange():","Event handler must be a function");this.onChangeHandlers.push(e)}runChangeHandlers(e){for(var t of this.onChangeHandlers)t(this,e)}getValue(){return this.resultValueInput.value}renderOptions(e){this.advancedClickableListComponent.clearItemsContainer();var t,r=[];for(t of e)r.push({attrs:{"data-option-value":t.value,"data-option-text":t.text},text:`<button>${t.text}</button>`});this.advancedClickableListComponent.appendItems(r)}stateActive(){return this.advancedClickableListComponent.isFocused()}blurComponent(){this.component.classList.remove("show"),this.displayingCurrentSelected.blur()}selectOption(e){var t=e.dataset.optionValue,e=e.dataset.optionText;this.viewContainer.innerHTML=e,this.resultValueInput.value=t,this.runChangeHandlers(t)}reset(){this.resultValueInput.value="",this.viewContainer.innerHTML=this.component.dataset.defaultText}}class SelectLocation{constructor(e){this.mapStyle=[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}],this.map,this.marker,this.location,this.selectorLocContainer=document.querySelector(".select-location-wrap"),this.displayLocationContainerInside=document.querySelector(".display-selected-location"),this.displayLocationContainerOutside=document.querySelector(e),this.initMap(),this.initEvents()}initMap(){window.addEventListener("load",e=>{var t={center:new google.maps.LatLng(50.4021702,30.3926104),zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:this.mapStyle,gestureHandling:"greedy"};this.map=new google.maps.Map(document.getElementsByClassName("select-location-map")[0],t),google.maps.event.addListener(this.map,"click",e=>{this.location=e.latLng,this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({position:this.location,map:this.map}),this.loadLocationLabels((e,t,r,s)=>{this.selectorLocContainer.querySelector(".apply-location").classList.remove("disable"),this.displayLocationContainerInside.innerHTML=`<span class="mdi mdi-map-marker-outline"></span> ${e.city} `+e.country}),google.maps.event.addListener(this.marker,"click",function(e){new google.maps.InfoWindow({content:"Latitude: "+this.location.lat()+"<br />Longitude: "+this.location.lng()}).open(this.map,this.marker)})})})}initEvents(){document.querySelector(".open-select-map").addEventListener("click",e=>{e.preventDefault(),this.openLocationSelector()}),this.selectorLocContainer.querySelectorAll(".close-select-location, .cancel-selecting-location").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),this.closeLocationSelector()})}),this.selectorLocContainer.querySelector(".apply-location").addEventListener("click",e=>{if(e.preventDefault(),e.currentTarget.classList.contains("disable"))return!1;this.loadLocationLabels((e,t,r,s)=>{this.selectorLocContainer.querySelector('[name="lat"]').value=r,this.selectorLocContainer.querySelector('[name="lng"]').value=s,this.selectorLocContainer.querySelector('[name="country_ru"]').value=t.country,this.selectorLocContainer.querySelector('[name="country_en"]').value=e.country,this.selectorLocContainer.querySelector('[name="region_ru"]').value=t.region,this.selectorLocContainer.querySelector('[name="region_en"]').value=e.region,this.selectorLocContainer.querySelector('[name="city_ru"]').value=t.city,this.selectorLocContainer.querySelector('[name="city_en"]').value=e.city,this.displayLocationContainerOutside.innerHTML=`<span class="mdi mdi-map-marker-outline"></span> ${e.city} `+e.country,document.querySelector(".open-select-map").innerHTML="Изменить местоположение",this.closeLocationSelector()})})}loadLocationLabels(r){let s=this.location.lat(),i=this.location.lng(),a,n;var e=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${s},${i}&key=AIzaSyDYKb4TgK3Ym5oiPzsTDtEf1jFMnWap3oo&language=en`;const o=new XMLHttpRequest;o.open("GET",e),o.onload=()=>{if(200==!o.status)return console.error("Error of request"),!1;var e=JSON.parse(o.response),e=(a=this.getLocationNamesFromMapRequest(e),`https://maps.googleapis.com/maps/api/geocode/json?latlng=${s},${i}&key=AIzaSyDYKb4TgK3Ym5oiPzsTDtEf1jFMnWap3oo&language=ru`);const t=new XMLHttpRequest;t.open("GET",e),t.onload=()=>{if(200==!t.status)return console.error("Error of request"),!1;var e=JSON.parse(t.response);n=this.getLocationNamesFromMapRequest(e),r(a,n,s,i)},t.send()},o.send()}openLocationSelector(){this.selectorLocContainer.classList.add("show"),navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{e={lat:e.coords.latitude,lng:e.coords.longitude};this.map.setCenter(e),this.map.setZoom(9)},()=>{console.warn("No access to geolocation")}):console.warn("Browser doesn't support Geolocation")}closeLocationSelector(){this.selectorLocContainer.classList.remove("show")}getLocationNamesFromMapRequest(r){let s="",i="",a="";for(let t=0;t<r.results.length;t++)if(1==r.results.length||"plus_code"==r.results[t].address_components[0].types[0])for(let e=0;e<r.results[t].address_components.length;e++)"country"==r.results[t].address_components[e].types[0]&&(s=r.results[t].address_components[e].long_name),"locality"==r.results[t].address_components[e].types[0]&&(i=r.results[t].address_components[e].long_name),"administrative_area_level_1"==r.results[t].address_components[e].types[0]&&(a=r.results[t].address_components[e].long_name);return{country:s,city:i,region:a}}}class Slider{constructor(e){this.component=e,this.component.getInstance=()=>this,this.val=0,this.startTrackMoving=!1,this.min=parseInt(this.component.getAttribute("data-min-val")),this.max=parseInt(this.component.getAttribute("data-max-val")),this.start=this.component.getAttribute("data-val"),this.defaultVal=this.component.getAttribute("data-default-val"),this.formValContainer=this.component.querySelector(".form-value-container"),this.bar=this.component.querySelector(".bar"),this.track=this.component.querySelector(".track"),this.manipulator=this.component.querySelector(".manipulator"),this.currentSliderVal=this.component.querySelector(".current-slider-val"),this.manipulatorWidth=this.manipulator.offsetWidth,this.setPos(this.start),this.initEvents()}setPos(e){this.bar.style.width=e/(this.max-this.min)*100+"%",this.manipulator.style.left=e/(this.max-this.min)*100+"%",this.currentSliderVal.innerHTML=e,this.val=e}reset(){this.setPos(this.defaultVal)}initEvents(){["mousedown","touchstart"].forEach(e=>this.manipulator.addEventListener(e,e=>this.startTrackMoving=!0)),["mouseup","touchend"].forEach(e=>document.addEventListener(e,e=>this.startTrackMoving=!1)),["mousedown","mousemove","touchstart","touchmove"].forEach(e=>document.addEventListener(e,e=>{var t;this.startTrackMoving&&(t=e.pageY||e.changedTouches[0].pageY,e=e.pageX||e.changedTouches[0].pageX,Math.abs(t-this.track.offsetTop)>this.manipulatorWidth/2&&(this.startTrackMoving=!1),t=e-this.track.offsetLeft,e=this.track.offsetWidth,t=Math.max(0,Math.min(100,t/e*100)),this.val=this.min+t/100*(this.max-this.min),this.formValContainer.value=Math.round(this.val),this.manipulator.style.left=t+"%",this.bar.style.width=t+"%",this.component.setAttribute("data-val",this.val),this.currentSliderVal.innerHTML=Math.round(this.val))})),this.formValContainer.addEventListener("change",e=>{this.setPos(e.currentTarget.value)})}}class Sorting{constructor(e,t){this.component=e,this.searchInstance=t,this.component.getInstance=()=>this,this.selectComponent=new Select(this.component.querySelector(".select")),this.initEvents()}initEvents(){this.selectComponent.addEventOnChange((e,t)=>{this.searchInstance.applySearchParamsAndSearching()})}getValue(){return this.selectComponent.getValue()}}class UAdPostForm{constructor(e){this.component=e,this.component.getInstance=()=>this,this.form=this.component.querySelector(".form.uadpost"),this.alertContainer=this.component.querySelector(".alert-container"),this.alert,this.initEvents()}initEvents(){this.form.addEventListener("submit",e=>{e.preventDefault(),this.submit()}),this.form.querySelector(".submit").addEventListener("click",e=>{this.form.setAttribute("action",this.form.getAttribute("data-action-submit"))}),this.form.querySelector(".submit-to-draft")?.addEventListener("click",e=>{this.form.setAttribute("action",this.form.getAttribute("data-action-submit-to-draft"))}),this.form.querySelectorAll("input, textarea").forEach(e=>e.addEventListener("input",e=>{e.currentTarget.classList.remove("error"),this.alert&&this.alert.close()}))}getFormData(){var e=new FormData(this.form),t=(e.delete("imgs"),this.component.querySelector(".component.img-uploader").getInstance().getPreparedData());return e.append("imgs",t.map(e=>e.alias,t)),e}submit(){if(this.form.classList.contains("disable"))return!1;var e=this.getFormData();this.form.classList.add("disable"),this.component.querySelectorAll(".submit-group button").forEach(e=>e.classList.add("disable")),this.component.querySelectorAll("input.error, textarea.error").forEach(e=>e.classList.remove("error")),this.alert&&this.alert.close();const r=new XMLHttpRequest;r.open("POST",this.form.getAttribute("action")),r.onload=()=>{if(this.component.querySelectorAll(".submit-group button").forEach(e=>e.classList.remove("disable")),this.form.classList.remove("disable"),200==r.status){try{JSON.parse(r.response)}catch(e){this.alert=createAlertComponent("danger",_atxt("undefined_error"),!0,!0).showIn(this.alertContainer),console.error("JSON unvalid, maybe server error")}const t=JSON.parse(r.response);if(console.log(t),t.status)this.alert=createAlertComponent("success",_atxt("success_and_redirecting"),!0,!0).showIn(this.alertContainer),setTimeout(()=>{document.location=t.data.redirect_url},t.data.redirect_delay);else{for(var e of t.failed_fields)this.component.querySelector(`[name="${e}"]`).classList.add("error");t.msg&&(this.alert=createAlertComponent("danger",t.msg,!0,!0).showIn(this.alertContainer))}}else console.error("Undefined error on server"),this.alert=createAlertComponent("danger",_atxt("undefined_error"),!0,!0).showIn(this.alertContainer)},r.onerror=()=>{console.error("Error of request to server"),this.alert=createAlertComponent("danger",_atxt("server_not_available"),!0,!0).showIn(this.alertContainer)},r.send(e)}}class Utils{constructor(){this.stockAnimationDuration=150}slideUp(e,t){t=t||this.stockAnimationDuration,e.style.overflow="hidden";var r=e.scrollHeight;const s=r/(t/16);let i=r;const a=setInterval(function(){0<i-s?(i-=s,e.style.height=i+"px"):(clearInterval(a),e.style.height="0",e.style.display="none")},16)}slideDown(e,t){t=t||this.stockAnimationDuration,e.style.height=0,e.style.overflow="hidden",e.style.display="block";const r=e.scrollHeight,s=r/(t/16);let i=0;const a=setInterval(function(){i+s<r?(i+=s,e.style.height=i+"px"):(clearInterval(a),e.style.height=r+"px")},16)}}const utils=new Utils;
//# sourceMappingURL=all.min.js.map
